<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Project 2</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
  </head>
  <body>
    <svg id = "cumulative" height = "500" width = "1200"></svg>
    <svg id = "pts" height = "600" width = "950">

    </svg>

    <div id="slider_div_pts">

    </div>

    <svg id = 'per' height = "600" width = "950">

    </svg>

    <div id="slider_div_PER">

    </div>

    <svg id = 'eFG' height = "600" width = "950">

    </svg>

    <div id= "slider_div_eFG">

    </div>
    <script>
      Promise.all([
        d3.csv("data/player_data.csv"),
        d3.csv("data/Seasons_States.csv"),
        d3.tsv("data/NBA_Draft_1980_2017.tsv")
      ]).then(function(data){
          //FILTERING OF DATA

        // console.log(data);

          // console.log(season_stats);
          let top_ten_picks = data[2].filter(d => d['year'] > "2002" && d['pick'] < 11)

          top_ten_picks[0]['player'] = 'James, LeBron'
          top_ten_picks[8]['player'] = 'Sweetney, Mike'
          top_ten_picks[46]['player'] = 'Jianlian, Yi'
          top_ten_picks[139]['player'] = 'Poeltl, Jakob'

          //Lebron and Michael's names were input incorrectly

          top_ten_stats = [];
          top_ten_picks.forEach(function(c, j){
            let player_name = c['player'];
            let season_stats = data[1].filter(g => g['Year'] > 2003);
            if(player_name.includes(",")){
              split_name = player_name.split(",")
              new_name = split_name[1].concat(" " + split_name[0]);
              new_name =  new_name.replace(/ /,"");
              new_name =  new_name.replace(/č/,"c");
              new_name =  new_name.replace(/ć/,"c");
              new_name =  new_name.replace(/ú/,"u");
              new_name =  new_name.replace(/ū/,"u");
              new_name =  new_name.replace(/ý/,"y");
              new_name =  new_name.replace(/ģ/,"g");
              new_name =  new_name.replace(/ņ/,"n");
              new_name =  new_name.replace(/\. /,".");

            }
            else{
              new_name = player_name
            };
            c['player'] = new_name;
            // console.log(new_name);
            season_stats.forEach(function(d,i){
              if(d['Player'] === new_name ){
                top_ten_stats.push(d);
              };
            });
            // console.log(season_stats);
          });

          draft_03 = data[2].filter(d => d['year'] === "2003" && d['pick'] < 11)
          draft_04 = data[2].filter(d => d['year'] === "2004" && d['pick'] < 11)
          draft_05 = data[2].filter(d => d['year'] === "2005" && d['pick'] < 11)
          draft_06 = data[2].filter(d => d['year'] === "2006" && d['pick'] < 11)
          draft_07 = data[2].filter(d => d['year'] === "2007" && d['pick'] < 11)
          draft_08 = data[2].filter(d => d['year'] === "2008" && d['pick'] < 11)
          draft_09 = data[2].filter(d => d['year'] === "2009" && d['pick'] < 11)
          draft_10 = data[2].filter(d => d['year'] === "2010" && d['pick'] < 11)
          draft_11 = data[2].filter(d => d['year'] === "2011" && d['pick'] < 11)
          draft_12 = data[2].filter(d => d['year'] === "2012" && d['pick'] < 11)
          draft_13 = data[2].filter(d => d['year'] === "2013" && d['pick'] < 11)
          draft_14 = data[2].filter(d => d['year'] === "2014" && d['pick'] < 11)
          draft_15 = data[2].filter(d => d['year'] === "2015" && d['pick'] < 11)
          draft_16 = data[2].filter(d => d['year'] === "2016" && d['pick'] < 11)
          draft_17 = data[2].filter(d => d['year'] === "2017" && d['pick'] < 11)
          draft_18 = data[2].filter(d => d['year'] === "2018" && d['pick'] < 11)

          // console.log(top_ten_picks);
          // console.log(top_ten_stats);

          console.log(top_ten_picks);
          // console.log(top_ten_stats);

          first_picks = data[2].filter(d => Number(d['year']) >= "2003" && Number(d['year']) < "2017" && d['pick']== 1);
          second_picks = data[2].filter(d => Number(d['year']) >= "2003" && Number(d['year']) < "2017" && d['pick']== 2);
          third_picks = data[2].filter(d => Number(d['year']) >= "2003" && Number(d['year']) < "2017" && d['pick']== 3);
          fourth_picks = data[2].filter(d => Number(d['year']) >= "2003" && Number(d['year']) < "2017" && d['pick']== 4);
          fifth_picks =  data[2].filter(d => Number(d['year']) >= "2003" && Number(d['year']) < "2017" && d['pick']== 5);
          sixth_picks =  data[2].filter(d => Number(d['year']) >= "2003" && Number(d['year']) < "2017" && d['pick']== 6);
          seventh_picks =  data[2].filter(d => Number(d['year']) >= "2003" && Number(d['year']) < "2017" && d['pick']== 7);
          eigth_picks = data[2].filter(d => Number(d['year']) >= "2003" && Number(d['year']) < "2017" && d['pick']== 8);
          ninth_picks = data[2].filter(d => Number(d['year']) >= "2003" && Number(d['year']) < "2017" && d['pick']== 9);
          tenth_picks = data[2].filter(d => Number(d['year']) >= "2003" && Number(d['year']) < "2017" && d['pick']== 10);
          console.log(first_picks);

          pick_01_all_stat =[]
          pick_01_cumulative_stats = {};
          pick_01_cumulative_stats['totalPts'] = 0;
          pick_01_cumulative_stats['']
          first_picks.forEach(function(a,k){
            top_ten_stats.forEach(function(d,i){
              if (a["player"] === d["Player"]){
                pick_01_all_stat.push(d);
                pick_01_cumulative_stats['totalPts'] = pick_01_cumulative_stats['totalPts'] + d['PPG'];
              };
            });
          });
          console.log(pick_01_all_stat);
          console.log(pick_01_cumulative_stats);
          // function picksData (pickNumber, year){

          // }
          console.log(draft_03);
          console.log(top_ten_stats);
          stats_03 = [];
          rookie_stats_03 = [];
          draft_03.forEach(function(c,j){
            top_ten_stats.forEach(function(d,i){
            if(d["tm"] === "TOT"){

            }
              if(d["Player"] === c['player']){
                d["PPG"] = d["PTS"]/d["G"];
                stats_03.push(d);
                if(d['Year'] === "2004"){
                  rookie_stats_03.push(d);
                };
              };
            });
          });

          stats_04 = [];
          rookie_stats_04 = [];
          draft_04.forEach(function(c,j){
            top_ten_stats.forEach(function(d,i){
            if(d["Player"] === c['player']){
              d["PPG"] = d["PTS"]/d["G"];
              stats_04.push(d);
              if(d['Year'] === "2005"){
                rookie_stats_04.push(d);
              };
            };
            });
          });

          stats_05 = [];
          rookie_stats_05 = [];
          draft_05.forEach(function(c,j){
            top_ten_stats.forEach(function(d,i){
            if(d["Player"] === c['player']){
              d["PPG"] = d["PTS"]/d["G"];
              stats_05.push(d);
              if(d['Year'] === "2006"){
                rookie_stats_05.push(d);
              };
            };
            });
          });

          stats_06 = [];
          rookie_stats_06 = [];
          draft_06.forEach(function(c,j){
            top_ten_stats.forEach(function(d,i){
            if(d["Player"] === c['player']){
              d["PPG"] = d["PTS"]/d["G"];
              stats_06.push(d);
              if(d['Year'] === "2007"){
                rookie_stats_06.push(d);
              };
            };
            });
          });

          stats_07 = [];
          rookie_stats_07 = [];
          draft_07.forEach(function(c,j){
            top_ten_stats.forEach(function(d,i){
            if(d["Player"] === c['player']){
              d["PPG"] = d["PTS"]/d["G"];
              stats_07.push(d);
              if(d['Year'] === "2008"){
                rookie_stats_07.push(d);
              };
            };
            });
          });

          stats_08 = [];
          rookie_stats_08 = [];
          draft_08.forEach(function(c,j){
            top_ten_stats.forEach(function(d,i){
            if(d["Player"] === c['player']){
              d["PPG"] = d["PTS"]/d["G"];
              stats_08.push(d);
              if(d['Year'] === "2009"){
                rookie_stats_08.push(d);
              };
            };
            });
          });

          stats_09 = [];
          rookie_stats_09 = [];
          draft_09.forEach(function(c,j){
            top_ten_stats.forEach(function(d,i){
            if(d["Player"] === c['player']){
              d["PPG"] = d["PTS"]/d["G"];
              stats_09.push(d);
              if(d['Year'] === "2010"){
                rookie_stats_09.push(d);
              };
            };
            });
          });

          stats_10 = [];
          rookie_stats_10 = [];
          draft_10.forEach(function(c,j){
            top_ten_stats.forEach(function(d,i){
            if(d["Player"] === c['player']){
              d["PPG"] = d["PTS"]/d["G"];
              stats_10.push(d);
              if(d['Year'] === "2011"){
                rookie_stats_10.push(d);
              };
            };
            });
          });

          stats_11 = [];
          rookie_stats_11 = [];
          draft_11.forEach(function(c,j){
            top_ten_stats.forEach(function(d,i){
            if(d["Player"] === c['player']){
              d["PPG"] = d["PTS"]/d["G"];
              stats_11.push(d);
              if(d['Year'] === "2012"){
                rookie_stats_11.push(d);
              };
            };
            });
          });

          stats_12 = [];
          rookie_stats_12 = [];
          draft_12.forEach(function(c,j){
            top_ten_stats.forEach(function(d,i){
            if(d["Player"] === c['player']){
              d["PPG"] = d["PTS"]/d["G"];
              stats_12.push(d);
              if(d['Year'] === "2013"){
                rookie_stats_12.push(d);
              };
            };
            });
          });

          stats_13 = [];
          rookie_stats_13 = [];
          draft_13.forEach(function(c,j){
            top_ten_stats.forEach(function(d,i){
            if(d["Player"] === c['player']){
              d["PPG"] = d["PTS"]/d["G"];
              stats_13.push(d);
              if(d['Year'] === "2014"){
                rookie_stats_13.push(d);
              };
            };
            });
          });

          stats_14 = [];
          rookie_stats_14 = [];
          draft_14.forEach(function(c,j){
            top_ten_stats.forEach(function(d,i){
            if(d["Player"] === c['player']){
              d["PPG"] = d["PTS"]/d["G"];
              stats_14.push(d);
              if(d['Year'] === "2015"){
                rookie_stats_14.push(d);
              };
            };
            });
          });

          stats_15 = [];
          rookie_stats_15 = [];
          draft_15.forEach(function(c,j){
            top_ten_stats.forEach(function(d,i){
            if(d["Player"] === c['player']){
              d["PPG"] = d["PTS"]/d["G"];
              stats_15.push(d);
              if(d['Year'] === "2016"){
                rookie_stats_15.push(d);
              };
            };
            });
          });

          stats_16 = [];
          rookie_stats_16 = [];
          draft_16.forEach(function(c,j){
            top_ten_stats.forEach(function(d,i){
            if(d["Player"] === c['player']){
              d["PPG"] = d["PTS"]/d["G"];
              stats_16.push(d);
              if(d['Year'] === "2017"){
                rookie_stats_16.push(d);
              };
            };
            });
          });

          first_picks = data[2].filter(d => Number(d['year']) >= "2003" && Number(d['year']) < "2017" && d['pick']== 1);
          second_picks = data[2].filter(d => Number(d['year']) >= "2003" && Number(d['year']) < "2017" && d['pick']== 2);
          third_picks = data[2].filter(d => Number(d['year']) >= "2003" && Number(d['year']) < "2017" && d['pick']== 3);
          fourth_picks = data[2].filter(d => Number(d['year']) >= "2003" && Number(d['year']) < "2017" && d['pick']== 4);
          fifth_picks = data[2].filter(d => Number(d['year']) >= "2003" && Number(d['year']) < "2017" && d['pick']== 5);
          sixth_picks = data[2].filter(d => Number(d['year']) >= "2003" && Number(d['year']) < "2017" && d['pick']== 6);
          seventh_picks = data[2].filter(d => Number(d['year']) >= "2003" && Number(d['year']) < "2017" && d['pick']== 7);
          eigth_picks = data[2].filter(d => Number(d['year']) >= "2003" && Number(d['year']) < "2017" && d['pick']== 8);
          ninth_picks = data[2].filter(d => Number(d['year']) >= "2003" && Number(d['year']) < "2017" && d['pick']== 9);
          tenth_picks = data[2].filter(d => Number(d['year']) >= "2003" && Number(d['year']) < "2017" && d['pick']== 10);
          console.log(first_picks);

          function cumulativeStats(player){
            player_stats = {};
            player_stats['Player'] = player;
            player_stats['years_in_league'] = 0;
            player_stats['PPG_total']= 0;
            player_stats['PER']=0;
            player_stats['eFG%']=0;
            top_ten_stats.forEach(function(d,i){
              if (d["Player"]=== player ){
                player_stats['years_in_league'] = player_stats['years_in_league'] + 1;
                player_stats['PPG_total'] = player_stats['PPG_total'] +  d["PPG"];
                player_stats['PER'] = player_stats['PER'] + Number(d['PER']);
                player_stats['eFG%'] = player_stats['eFG%'] +  Number(d['eFG%']);
              }
            });
            player_stats['PPG_total_average'] = player_stats['PPG_total'] / player_stats['years_in_league']
            player_stats['PER_average'] = player_stats['PER'] / player_stats['years_in_league']
            player_stats['eFG%_average'] = player_stats['eFG%'] / player_stats['years_in_league']
            return(player_stats);
          };

          console.log(cumulativeStats('LeBron James'));



          var first_pick_players = [];
          first_picks.forEach(function(d,i){
            if (!first_pick_players.includes(d["player"])){
              first_pick_players.push(d["player"]);
            }
          });
          console.log(first_pick_players);

          lebron_stats = {};
          lebron_stats['PPG_total'] = 0;
          lebron_stats['years_in_league'] = 0;
          lebron_stats['PER'] = 0;
          lebron_stats['eFG%'] = 0;
          top_ten_stats.forEach(function(d,i){
            if (d["Player"] === "LeBron James"){
              lebron_stats['years_in_league'] = lebron_stats['years_in_league'] + 1;
              lebron_stats['PPG_total'] = lebron_stats['PPG_total'] +  d["PPG"];
              lebron_stats['PER'] = lebron_stats['PER'] + Number(d['PER']);
              lebron_stats['eFG%'] = lebron_stats['eFG%'] +  Number(d['eFG%']);
            }
          });
          console.log(lebron_stats);

          // pick_01_all_stat =[]
          // pick_01_cumulative_stats = {};
          // pick_01_cumulative_stats['totalPts'] = 0;
          // pick_01_cumulative_stats['']
          // first_picks.forEach(function(a,k){
          //   top_ten_stats.forEach(function(d,i){
          //     if (a["player"] === d["Player"]){
          //       pick_01_all_stat.push(d);
          //       pick_01_cumulative_stats['totalPts'] = pick_01_cumulative_stats['totalPts'] + d['PPG'];
          //     };
          //   });
          // });
          // console.log(pick_01_all_stat);
          // console.log(pick_01_cumulative_stats);






        // -------------------------------- Overview -------------------------------

          let overallDrafts = d3.select("svg#cumulative");
          let overall_xscale = d3.scaleLinear().domain([2000,2020]).range([0,1150]);
          let overall_xticks = []
          for (var i=2000; i<=2020; i++){
            overall_xticks.push(i);
          }
          let overall_xaxis = d3.axisBottom().scale(overall_xscale).tickValues(overall_xticks);
          let overall_x_axis = overallDrafts.append("g")
            .attr("transform", "translate(25, 450)")
            .style("font","8px times")
            .call(overall_xaxis);

          let overall_yscale = d3.scaleLinear().domain([30,0]).range([0,450]);

          console.log(rookie_stats_03);


        // -------------------------------- PTS -------------------------------

          let pts = d3.select("svg#pts");
          let pts_chart = pts.append('g');

          let pts_scale = d3.scaleLinear().domain([30, 0]).range([0, 500]);
          let player_scale = d3.scaleLinear().domain([10, 0]).range([800, 0]);

          let x_axis = d3.axisBottom(player_scale).ticks(0);
          var y_axis_pts = d3.axisLeft(pts_scale).ticks(7);

          x_scale = pts.append("g")
              .attr("transform","translate(80,510)")
              .call(x_axis);


          var slider_container = d3.selectAll("#slider_div_pts").append("div");

          let rookie_classes = [rookie_stats_03,rookie_stats_04,rookie_stats_05,rookie_stats_06,rookie_stats_07,rookie_stats_08,rookie_stats_09,rookie_stats_10,rookie_stats_11,rookie_stats_12,rookie_stats_13,rookie_stats_14,rookie_stats_15,rookie_stats_16];

          var missing = {}
          draft_07.forEach(function(c,j){
            rookie_stats_07.forEach(function(d,i){
              if(c['player'] === d['Player']){
                if(j != i){
                  missing['Player'] = draft_07[i]['player'];
                  missing['PPG'] = 0;
                  missing['PER'] = 0;
                  missing['eFG%'] = 0;
                  missing['Year'] = draft_07[i]['Year'];
                  rookie_stats_07.splice(i, 0, missing)
                }
              }
            });
          });


          draft_09.forEach(function(c,j){
            rookie_stats_09.forEach(function(d,i){
              if(c['player'] === d['Player']){
                if(j != i){
                  var missing = {}
                  missing['Player'] = draft_09[i]['player'];
                  missing['PPG'] = 0;
                  missing['PER'] = 0;
                  missing['eFG%'] = 0;
                  missing['Year'] = draft_09[i]['Year'];
                  rookie_stats_09.splice(i, 0, missing)
                }
              }
            });
          });

          var missing = {}
          draft_11.forEach(function(c,j){
            rookie_stats_11.forEach(function(d,i){
              if(c['player'] === d['Player']){
                if(j != i){
                  missing['Player'] = draft_11[i]['player'];
                  missing['PPG'] = 0;
                  missing['PER'] = 0;
                  missing['eFG%'] = 0;
                  missing['Year'] = draft_11[i]['Year'];
                  rookie_stats_11.splice(i, 0, missing)
                }
              }
            });
          });

          var missing = {}
          draft_13.forEach(function(c,j){
            rookie_stats_13.forEach(function(d,i){
              if(c['player'] === d['Player']){
                if(j != i){
                  missing['Player'] = draft_13[i]['player'];
                  missing['PPG'] = 0;
                  missing['PER'] = 0;
                  missing['eFG%'] = 0;
                  missing['Year'] = draft_13[i]['Year'];
                  rookie_stats_13.splice(i, 0, missing)
                }
              }
            });
          });

          var missing = {}
          draft_14.forEach(function(c,j){
            rookie_stats_14.forEach(function(d,i){
              if(c['player'] === d['Player']){
                if(j != i){
                  missing['Player'] = draft_14[i]['player'];
                  missing['PPG'] = 0;
                  missing['PER'] = 0;
                  missing['eFG%'] = 0;
                  missing['Year'] = draft_14[i]['Year'];
                  rookie_stats_14.splice(i, 0, missing)
                }
              }
            });
          });

          var missing = {}
          draft_16.forEach(function(c,j){
            rookie_stats_16.forEach(function(d,i){
              if(c['player'] === d['Player']){
                if(j != i){
                  missing['Player'] = draft_16[i]['player'];
                  missing['PPG'] = 0;
                  missing['PER'] = 0;
                  missing['eFG%'] = 0;
                  missing['Year'] = draft_16[i]['Year'];
                  rookie_stats_16.splice(i, 0, missing)
                }
              }
            });
          });

          console.log(draft_09);
          console.log(rookie_stats_07);

          function show_pts(year){
            let index = 1;
            let rookie_class = rookie_classes[year];
            y_scale = pts.append("g")
                .attr("transform","translate(80,10)")
                .call(y_axis_pts);

              rookie_class.forEach(function(d,i){
              pts_chart.append('rect')
                  .attr("width", "20")
                  .attr("height", 500 - pts_scale(d['PPG']))
                  .attr("x", player_scale(index) - 20)
                  .attr("y", 510 - (500 - pts_scale(d['PPG'])))
                  .attr("stroke", "black")
                  .style("fill", "orange")
                  .attr("transform", "translate(80,0)")
              pts.append('text')
                  .attr("text-anchor", "middle")
                  .attr("x", player_scale(index) + 70)
                  .attr("y", 530)
                  .attr("font-family","Apple Ligothic")
                  .attr("font-size", "12px")
                  .text(d['Player']);
              index++
            });
          }

          show_pts(0);

          slider_container.append("input")
              .attr("type", "range")
              .attr("min", 0)
              .attr("max", 13)
              .attr("value", 0)
              .attr("class", "slider")
              .style("width", "300px")
              .attr("step", 1)
              .on("input", function(){
                pts_chart.selectAll("rect").remove()
                pts.selectAll("text").remove()
                year = Number(this.value)
                show_pts(year);
              });

// -------------------------------- PER -------------------------------
          let per = d3.select("svg#per");
          let per_chart = per.append('g');

          let per_scale = d3.scaleLinear().domain([30, 0]).range([0, 500]);

          var y_axis_per = d3.axisLeft(per_scale).ticks(7);

          x_scale = per.append("g")
              .attr("transform","translate(80,510)")
              .call(x_axis);

          var slider_container_PER = d3.selectAll("#slider_div_PER").append("div");


          function show_per(year){
            let index = 1;
            let rookie_class = rookie_classes[year];
            y_scale = per.append("g")
                .attr("transform","translate(80,10)")
                .call(y_axis_per);
              rookie_class.forEach(function(d,i){
              per_chart.append('rect')
                  .attr("width", "20")
                  .attr("height", 500 - per_scale(d['PER']))
                  .attr("x", player_scale(index) - 20)
                  .attr("y", 510 - (500 - per_scale(d['PER'])))
                  .attr("stroke", "black")
                  .style("fill", "orange")
                  .attr("transform", "translate(80,0)")
              per.append('text')
                  .attr("text-anchor", "middle")
                  .attr("x", player_scale(index) + 70)
                  .attr("y", 530)
                  .attr("font-family","Apple Ligothic")
                  .attr("font-size", "12px")
                  .text(d['Player']);
              index++
            });
          }

          show_per(0);
          slider_container_PER.append("input")
              .attr("type", "range")
              .attr("min", 0)
              .attr("max", 13)
              .attr("value", 0)
              .attr("class", "slider")
              .style("width", "300px")
              .attr("step", 1)
              .on("input", function(){
                per_chart.selectAll("rect").remove()
                per.selectAll("text").remove()
                year = Number(this.value)
                show_per(year);
              });

          console.log(rookie_stats_03);
          console.log(rookie_classes)

        // ------------------------ eFG% ----------------------------

        let eFG = d3.select("svg#eFG");
        let eFG_chart = eFG.append('g');

        let eFG_scale = d3.scaleLinear().domain([1, 0]).range([0, 500]);

        var y_axis_eFG = d3.axisLeft(eFG_scale).ticks(10);

        x_scale = eFG.append("g")
            .attr("transform","translate(80,510)")
            .call(x_axis);

        var slider_container_eFG = d3.selectAll("#slider_div_eFG").append("div");


        function show_eFG(year){
          let index = 1;
          let rookie_class = rookie_classes[year];
          y_scale = eFG.append("g")
              .attr("transform","translate(80,10)")
              .call(y_axis_eFG);
            rookie_class.forEach(function(d,i){
            eFG_chart.append('rect')
                .attr("width", "20")
                .attr("height", 500 - eFG_scale(d['eFG%']))
                .attr("x", player_scale(index) - 20)
                .attr("y", 510 - (500 - eFG_scale(d['eFG%'])))
                .attr("stroke", "black")
                .style("fill", "orange")
                .attr("transform", "translate(80,0)")
            eFG.append('text')
                .attr("text-anchor", "middle")
                .attr("x", player_scale(index) + 70)
                .attr("y", 530)
                .attr("font-family","Apple Ligothic")
                .attr("font-size", "12px")
                .text(d['Player']);
            index++
          });
        }

        show_eFG(0);
        slider_container_eFG.append("input")
            .attr("type", "range")
            .attr("min", 0)
            .attr("max", 13)
            .attr("value", 0)
            .attr("class", "slider")
            .style("width", "300px")
            .attr("step", 1)
            .on("input", function(){
              eFG_chart.selectAll("rect").remove()
              eFG.selectAll("text").remove()
              year = Number(this.value)
              show_eFG(year);
            });

        });
    </script>
  </body>
</html>
